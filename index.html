<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MW Event & Destruction Schedule</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@500;700&display=swap');

        body {
            background-color: #0f172a;
            color: #e2e8f0;
            font-family: 'Roboto', sans-serif;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            margin: 0;
            padding: 40px 20px;
            box-sizing: border-box;
            touch-action: manipulation; 
        }

        /* --- 1. LAYOUT: 3 COLUMNS --- */
        .main-wrapper {
            display: grid;
            grid-template-columns: repeat(3, 1fr); /* 3 Equal Columns */
            gap: 20px;
            width: 100%;
            max-width: 1200px; /* Wider to fit 3 cols */
        }

        .container {
            background: #1e293b;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(6, 182, 212, 0.3);
            border: 2px solid #06b6d4;
            display: flex;
            flex-direction: column;
            position: relative;
            min-height: 500px; /* Align heights roughly */
        }

        .destruct-container {
            border-color: #f87171;
            box-shadow: 0 0 20px rgba(248, 113, 113, 0.3);
        }

        .epic-container {
            border-color: #a855f7;
            box-shadow: 0 0 20px rgba(168, 85, 247, 0.3);
        }

        h2 {
            text-align: center;
            color: #fff;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin: 0 0 10px 0;
            font-size: 1.5em;
            text-shadow: 0 0 10px rgba(255,255,255,0.3);
        }

        h3 {
            text-align: center;
            color: #cbd5e1;
            font-size: 1.1em;
            margin: 20px 0 10px 0;
            border-bottom: 1px solid #334155;
            padding-bottom: 5px;
        }

        .subtitle {
            text-align: center;
            color: #94a3b8;
            font-size: 0.85em;
            margin-bottom: 15px;
        }

        /* --- CONTROLS --- */
        .controls {
            margin-bottom: 15px;
            text-align: center;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        select {
            background-color: #0f172a;
            color: #67e8f9;
            border: 1px solid #334155;
            padding: 10px;
            border-radius: 5px;
            font-family: 'Roboto', sans-serif;
            width: 100%;
            cursor: pointer;
            outline: none;
            box-sizing: border-box;
            text-align: center;
            font-size: 1.1em;
        }

        /* --- CUSTOM TIME PICKER --- */
        .time-picker-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            background: #0f172a;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #334155;
        }

        .tp-row {
            display: flex;
            justify-content: center;
            gap: 15px;
            align-items: center;
        }

        .tp-col {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .tp-btn {
            background: #334155;
            color: #f87171;
            border: none;
            width: 50px;
            height: 35px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.2s;
            opacity: 1;
        }

        .hidden { display: none !important; }

        .tp-display {
            font-family: monospace;
            font-size: 2.2em;
            font-weight: bold;
            color: #fff;
            background: #1e293b;
            padding: 5px 15px;
            border-radius: 4px;
            min-width: 60px;
            text-align: center;
            user-select: none;
        }

        .tp-colon {
            font-size: 2em;
            font-weight: bold;
            color: #64748b;
            margin-top: -4px;
        }

        /* BUTTONS */
        .action-buttons {
            display: flex;
            gap: 10px;
            width: 100%;
        }

        .btn-main {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
            font-size: 0.9em;
            transition: background 0.2s;
            background: #334155;
            color: #cbd5e1;
        }
        
        .btn-main.active {
            background: #a855f7;
            color: #fff;
        }

        .btn-edit { background: #f87171; color: #0f172a; }
        .btn-edit:hover { background: #ef4444; }
        
        .btn-reset { background: #334155; color: #cbd5e1; }
        .btn-reset:hover { background: #475569; }

        .shift-controls {
            display: flex;
            gap: 5px;
            justify-content: center;
            margin-top: 5px;
            width: 100%;
        }
        
        .btn-shift {
            background: #1e293b;
            color: #cbd5e1;
            border: 1px solid #334155;
            padding: 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85em;
            flex: 1;
        }
        .btn-shift:hover { background: #334155; border-color: #f87171; color: #fff; }

        .clock-display {
            color: #94a3b8;
            font-size: 0.9em;
            margin-top: 5px;
        }

        /* --- TABLE STYLES --- */
        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 4px;
        }

        th {
            color: #06b6d4;
            padding: 8px;
            text-transform: uppercase;
            border-bottom: 2px solid #334155;
            font-size: 0.9em;
        }

        .destruct-container th { color: #f87171; }
        .epic-container th { color: #d8b4fe; }

        td {
            padding: 10px 12px;
            background-color: #0f172a;
            font-size: 0.95em;
            transition: all 0.3s ease;
        }

        tr td:first-child { border-top-left-radius: 8px; border-bottom-left-radius: 8px; }
        tr td:last-child { border-top-right-radius: 8px; border-bottom-right-radius: 8px; }

        .time-col {
            text-align: center;
            font-weight: bold;
            color: #cbd5e1;
            width: 30%;
            font-family: monospace;
            font-size: 1.1em;
        }

        .event-col {
            text-align: left;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .icon { font-size: 1.2em; width: 25px; text-align: center; }
        
        /* ICONS */
        .snow { color: #67e8f9; }
        .football { color: #4ade80; }
        .koth { color: #fbbf24; }
        .tvt { color: #f87171; }
        .hero { color: #a855f7; }
        .skull { color: #f87171; }
        .aq { color: #fbbf24; } 
        .core { color: #60a5fa; } 
        .orfen { color: #34d399; } 
        .baium { color: #ef4444; } 
        .helios { color: #fbbf24; }
        .kelbim { color: #a855f7; }
        .lind { color: #a5f3fc; } 
        .faf { color: #3b82f6; } 
        .val { color: #ef4444; } 
        .ant { color: #d97706; } 

        /* STATES */
        tr.active td {
            background-color: #0f3847;
            color: #fff;
            border-top: 2px solid #4ade80;
            border-bottom: 2px solid #4ade80;
        }
        tr.active td:first-child { border-left: 2px solid #4ade80; }
        tr.active td:last-child { border-right: 2px solid #4ade80; }
        
        .destruct-container tr.active td {
            background-color: #450a0a;
            border-color: #f87171;
            color: #fff;
        }
        .destruct-container tr.active td:first-child { border-left: 2px solid #f87171; }
        .destruct-container tr.active td:last-child { border-right: 2px solid #f87171; }

        tr.active { animation: pulse 2s infinite; }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.8; }
            100% { opacity: 1; }
        }

        .active-badge {
            font-size: 0.65em;
            background: #4ade80;
            color: #0f172a;
            padding: 2px 5px;
            border-radius: 4px;
            font-weight: bold;
            margin-left: auto;
        }
        
        .day-badge {
            font-size: 0.7em;
            background: #334155;
            color: #cbd5e1;
            padding: 2px 6px;
            border-radius: 4px;
            margin-left: auto;
        }
        .today .day-badge {
            background: #a855f7;
            color: #fff;
            font-weight: bold;
        }

        /* LOCATION LIST */
        .loc-table td {
            font-size: 0.85em;
            padding: 6px 10px;
            color: #cbd5e1;
        }
        .loc-lvl { text-align: center; color: #fbbf24; font-weight: bold; width: 20%; }
        .loc-count { text-align: center; color: #f87171; font-weight: bold; width: 15%; }
        .loc-name { text-align: left; }

        /* EMPTY STATE */
        .empty-state {
            text-align: center;
            color: #64748b;
            padding: 40px 10px;
            font-style: italic;
        }
        .empty-icon {
            font-size: 3em;
            display: block;
            margin-bottom: 10px;
            opacity: 0.5;
        }

        /* --- RESPONSIVE: Stack on Tablet/Mobile --- */
        @media (max-width: 1000px) {
            .main-wrapper { 
                grid-template-columns: 1fr; /* Stack all vertically */
                max-width: 500px;
            }
            h2 { font-size: 1.3em; }
        }
    </style>
</head>
<body>

    <div class="main-wrapper">
        
        <div class="container">
            <h2>Event Schedule</h2>
            
            <div class="controls">
                <select id="timezoneSelect" onchange="handleTimezoneChange()">
                    </select>
                <div class="clock-display" id="clock">Loading time...</div>
            </div>

            <table>
                <thead>
                    <tr>
                        <th>Time</th>
                        <th>Event</th>
                    </tr>
                </thead>
                <tbody id="scheduleBody"></tbody>
            </table>
        </div>

        <div class="container destruct-container">
            <h2>Destruction</h2>
            <div class="subtitle">Respawn: Every 4 Hours</div>
            
            <div class="controls">
                <label style="color:#cbd5e1; font-size:0.9em;">Anchor Time (Next/Last):</label>
                
                <div class="time-picker-wrapper">
                    <div class="tp-row hidden" id="arrowsUp">
                        <div class="tp-col"><button class="tp-btn" onclick="adjustTime(1, 0)">â–²</button></div>
                        <div style="width:10px;"></div>
                        <div class="tp-col"><button class="tp-btn" onclick="adjustTime(0, 1)">â–²</button></div>
                    </div>
                    <div class="tp-row">
                        <div class="tp-display" id="displayHH">00</div>
                        <div class="tp-colon">:</div>
                        <div class="tp-display" id="displayMM">34</div>
                    </div>
                    <div class="tp-row hidden" id="arrowsDown">
                        <div class="tp-col"><button class="tp-btn" onclick="adjustTime(-1, 0)">â–¼</button></div>
                        <div style="width:10px;"></div>
                        <div class="tp-col"><button class="tp-btn" onclick="adjustTime(0, -1)">â–¼</button></div>
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="btn-main btn-edit" id="btnEdit" onclick="toggleEditMode()">Edit</button>
                    <button class="btn-main btn-reset" onclick="resetDestruction()">Reset</button>
                </div>

                <div class="shift-controls hidden" id="shiftControls">
                    <button class="btn-shift" onclick="adjustTime(0, -1)">-1m</button>
                    <button class="btn-shift" onclick="adjustTime(0, 1)">+1m</button>
                    <button class="btn-shift" onclick="adjustTime(0, 5)">+5m</button>
                </div>
            </div>

            <table>
                <thead>
                    <tr>
                        <th>Schedule</th>
                        <th>Info</th>
                    </tr>
                </thead>
                <tbody id="destructBody"></tbody>
            </table>

            <h3>Spawn Locations</h3>
            <table class="loc-table">
                <thead>
                    <tr>
                        <th>Lvl</th>
                        <th>RBs</th>
                        <th style="text-align:left; padding-left:10px;">Location</th>
                    </tr>
                </thead>
                <tbody id="locBody"></tbody>
            </table>
        </div>

        <div class="container epic-container">
            <h2>Epic Bosses</h2>
            
            <div class="controls">
                <div class="action-buttons">
                    <button class="btn-main active" id="btnToday" onclick="setEpicMode('today')">Today</button>
                    <button class="btn-main" id="btnUpcoming" onclick="setEpicMode('upcoming')">Upcoming</button>
                </div>
            </div>
            
            <table>
                <thead>
                    <tr>
                        <th>Day</th>
                        <th>Time</th>
                        <th style="text-align:left">Boss</th>
                    </tr>
                </thead>
                <tbody id="epicBody"></tbody>
            </table>
        </div>

    </div>

    <script>
        // ==========================================
        //         PART 1: EVENT SCHEDULE
        // ==========================================
        const baseEvents = [
            { time: "02:00", name: "Snow Fight", type: "snow", icon: "â„ï¸" },
            { time: "04:00", name: "Football", type: "football", icon: "âš½" },
            { time: "06:00", name: "King of the Hill", type: "koth", icon: "ðŸ‘‘" },
            { time: "08:00", name: "Team vs Team", type: "tvt", icon: "âš”ï¸" },
            { time: "10:00", name: "Snow Fight", type: "snow", icon: "â„ï¸" },
            { time: "12:00", name: "Football", type: "football", icon: "âš½" },
            { time: "14:00", name: "King of the Hill", type: "koth", icon: "ðŸ‘‘" },
            { time: "16:00", name: "Team vs Team", type: "tvt", icon: "âš”ï¸" },
            { time: "18:00", name: "Football", type: "football", icon: "âš½" },
            { time: "19:00", name: "King of the Hill", type: "koth", icon: "ðŸ‘‘" },
            { time: "20:05", name: "Team vs Team", type: "tvt", icon: "âš”ï¸" }, 
            { time: "21:00", name: "Snow Fight", type: "snow", icon: "â„ï¸" },
            { time: "21:30", name: "Last Hero", type: "hero", icon: "ðŸ†" },
            { time: "22:00", name: "Football", type: "football", icon: "âš½" },
            { time: "23:00", name: "King of the Hill", type: "koth", icon: "ðŸ‘‘" },
            { time: "00:00", name: "Team vs Team", type: "tvt", icon: "âš”ï¸" } 
        ];

        const BASE_OFFSET = 3; 

        const timezones = [
            { label: "Hawaii (UTC-10)", offset: -10 },
            { label: "Los Angeles / PT (UTC-8)", offset: -8 },
            { label: "New York / ET (UTC-5)", offset: -5 },
            { label: "Sao Paulo (UTC-3)", offset: -3 },
            { label: "London / UTC (UTC+0)", offset: 0 },
            { label: "Berlin / CET (UTC+1)", offset: 1 },
            { label: "Kyiv / EET (UTC+2)", offset: 2 },
            { label: "Moscow / MSK (UTC+3)", offset: 3 },
            { label: "Dubai (UTC+4)", offset: 4 },
            { label: "India (UTC+5.5)", offset: 5.5 },
            { label: "Bangkok (UTC+7)", offset: 7 },
            { label: "Singapore / China (UTC+8)", offset: 8 },
            { label: "Tokyo (UTC+9)", offset: 9 },
            { label: "Sydney (UTC+11)", offset: 11 }
        ];

        function initSchedule() {
            const select = document.getElementById('timezoneSelect');
            const localOffset = -(new Date().getTimezoneOffset() / 60);
            
            const knownTz = timezones.find(tz => tz.offset === localOffset);
            let defaultLabel = `Local Time (UTC${localOffset >= 0 ? '+' : ''}${localOffset})`;
            
            if (!knownTz) {
                const localOption = document.createElement('option');
                localOption.value = localOffset;
                localOption.text = defaultLabel;
                select.add(localOption);
            }

            timezones.forEach(tz => {
                const opt = document.createElement('option');
                opt.value = tz.offset;
                opt.text = tz.label;
                if (tz.offset === localOffset) opt.selected = true;
                select.add(opt);
            });

            updateSchedule();
            setInterval(updateSchedule, 60000);
        }

        function handleTimezoneChange() {
            updateSchedule();
            calcDestruction(); 
            updateEpics(); 
        }

        function updateSchedule() {
            const select = document.getElementById('timezoneSelect');
            const targetOffset = parseFloat(select.value);
            const tbody = document.getElementById('scheduleBody');
            tbody.innerHTML = ''; 

            let displayEvents = baseEvents.map(event => {
                const [h, m] = event.time.split(':').map(Number);
                let totalMinutes = (h * 60 + m) - (BASE_OFFSET * 60) + (targetOffset * 60);
                if (totalMinutes < 0) totalMinutes += 1440;
                if (totalMinutes >= 1440) totalMinutes -= 1440;

                const newH = Math.floor(totalMinutes / 60);
                const newM = totalMinutes % 60;
                const timeString = `${String(newH).padStart(2, '0')}:${String(newM).padStart(2, '0')}`;
                
                return { ...event, displayTime: timeString, minutes: totalMinutes };
            });

            displayEvents.sort((a, b) => a.minutes - b.minutes);

            const now = new Date();
            const utcMinutes = now.getUTCHours() * 60 + now.getUTCMinutes();
            const currentTargetMinutes = utcMinutes + (targetOffset * 60);
            
            let normalizedNow = currentTargetMinutes;
            while (normalizedNow < 0) normalizedNow += 1440;
            while (normalizedNow >= 1440) normalizedNow -= 1440;

            let nextEventIndex = -1;
            for (let i = 0; i < displayEvents.length; i++) {
                if (displayEvents[i].minutes > normalizedNow) {
                    nextEventIndex = i;
                    break;
                }
            }
            if (nextEventIndex === -1 && displayEvents.length > 0) nextEventIndex = 0;

            displayEvents.forEach((event, index) => {
                const tr = document.createElement('tr');
                if (index === nextEventIndex) tr.className = 'active';
                const badge = index === nextEventIndex ? '<span class="active-badge">NEXT</span>' : '';
                tr.innerHTML = `
                    <td class="time-col">${event.displayTime}</td>
                    <td class="event-col"><span class="icon ${event.type}">${event.icon}</span> ${event.name} ${badge}</td>
                `;
                tbody.appendChild(tr);
            });

            const nowH = Math.floor(normalizedNow / 60);
            const nowM = Math.floor(normalizedNow % 60);
            document.getElementById('clock').innerText = 
                `Current Time: ${String(nowH).padStart(2, '0')}:${String(nowM).padStart(2, '0')}`;
        }

        // ==========================================
        //      PART 2: DESTRUCTION
        // ==========================================
        const DEFAULT_DESTRUCT_TIME = "00:34";
        
        let destructH = 0;
        let destructM = 34;
        let isEditing = false;

        function initDestruction() {
            const savedTime = localStorage.getItem('destructTime');
            if (savedTime) {
                const [h, m] = savedTime.split(':').map(Number);
                destructH = h;
                destructM = m;
            } else {
                calculateSmartDefault();
            }
            updatePickerDisplay();
            calcDestruction();
            renderLocations();
            setInterval(calcDestruction, 60000); 
        }

        function calculateSmartDefault() {
            let anchorMins = 0 * 60 + 34;
            const select = document.getElementById('timezoneSelect');
            const targetOffset = parseFloat(select.value || -(new Date().getTimezoneOffset() / 60));
            const now = new Date();
            const utcMinutes = now.getUTCHours() * 60 + now.getUTCMinutes();
            let currentMins = utcMinutes + (targetOffset * 60);
            while (currentMins < 0) currentMins += 1440;
            while (currentMins >= 1440) currentMins -= 1440;

            let guard = 0;
            while (anchorMins < currentMins && guard < 12) {
                anchorMins += 240;
                guard++;
            }
            while (anchorMins >= 1440) anchorMins -= 1440;

            destructH = Math.floor(anchorMins / 60);
            destructM = anchorMins % 60;
        }

        function toggleEditMode() {
            isEditing = !isEditing;
            const arrowsUp = document.getElementById('arrowsUp');
            const arrowsDown = document.getElementById('arrowsDown');
            const shiftControls = document.getElementById('shiftControls');
            const btnEdit = document.getElementById('btnEdit');

            if (isEditing) {
                arrowsUp.classList.remove('hidden');
                arrowsDown.classList.remove('hidden');
                shiftControls.classList.remove('hidden');
                btnEdit.innerText = "Done";
                btnEdit.style.background = "#4ade80";
                btnEdit.style.color = "#0f172a";
            } else {
                arrowsUp.classList.add('hidden');
                arrowsDown.classList.add('hidden');
                shiftControls.classList.add('hidden');
                btnEdit.innerText = "Edit";
                btnEdit.style.background = "#f87171";
                btnEdit.style.color = "#0f172a";
            }
        }

        function updatePickerDisplay() {
            document.getElementById('displayHH').innerText = String(destructH).padStart(2, '0');
            document.getElementById('displayMM').innerText = String(destructM).padStart(2, '0');
            const timeStr = `${String(destructH).padStart(2, '0')}:${String(destructM).padStart(2, '0')}`;
            localStorage.setItem('destructTime', timeStr);
        }

        function adjustTime(deltaH, deltaM) {
            let newH = destructH + deltaH;
            let newM = destructM + deltaM;

            while (newM >= 60) { newM -= 60; newH++; }
            while (newM < 0) { newM += 60; newH--; }
            while (newH >= 24) newH -= 24;
            while (newH < 0) newH += 24;

            destructH = newH;
            destructM = newM;

            updatePickerDisplay();
            calcDestruction();
        }

        function resetDestruction() {
            calculateSmartDefault();
            updatePickerDisplay();
            calcDestruction();
        }

        function calcDestruction() {
            const tbody = document.getElementById('destructBody');
            tbody.innerHTML = '';

            let anchorMins = destructH * 60 + destructM;
            const select = document.getElementById('timezoneSelect');
            const targetOffset = parseFloat(select.value || -(new Date().getTimezoneOffset() / 60));
            const now = new Date();
            const utcMinutes = now.getUTCHours() * 60 + now.getUTCMinutes();
            
            let currentMins = utcMinutes + (targetOffset * 60);
            while (currentMins < 0) currentMins += 1440;
            while (currentMins >= 1440) currentMins -= 1440;

            let effectiveAnchor = anchorMins;
            if (effectiveAnchor > currentMins) {
                effectiveAnchor -= 1440; 
            }
            while (effectiveAnchor <= currentMins) {
                effectiveAnchor += 240;
            }

            let tempMins = effectiveAnchor;

            for(let i=1; i<=5; i++) {
                let displayMins = tempMins;
                while(displayMins >= 1440) displayMins -= 1440;
                while(displayMins < 0) displayMins += 1440;
                
                const h = Math.floor(displayMins / 60);
                const m = displayMins % 60;
                const timeStr = `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}`;
                
                const tr = document.createElement('tr');
                let badge = '';

                if (i === 1) {
                    tr.className = 'active';
                    badge = '<span class="active-badge">NEXT</span>';
                }

                tr.innerHTML = `
                    <td class="time-col" style="color:#fca5a5">${timeStr}</td>
                    <td class="event-col">
                        <span class="icon skull">ðŸ’€</span> Spawn #${i}
                        ${badge}
                    </td>
                `;
                tbody.appendChild(tr);
                tempMins += 240; 
            }
        }

        function renderLocations() {
            const locations = [
                { name: "Dark Elf Village", count: 1, lvl: 30 },
                { name: "Orc Village", count: 1, lvl: 30 },
                { name: "Dwarven Village", count: 2, lvl: 30 }, 
                { name: "Gludin Village", count: 3, lvl: 30 },
                { name: "Heine", count: 2, lvl: 45 },
                { name: "Dion", count: 3, lvl: 45 },
                { name: "Gludio", count: 3, lvl: 45 },
                { name: "Schuttgart", count: 1, lvl: 60 }, 
                { name: "Giran", count: 3, lvl: 60 },
                { name: "Oren", count: 3, lvl: 60 },
                { name: "Aden", count: 3, lvl: 75 },
                { name: "Goddard", count: 2, lvl: 80 }
            ];

            locations.sort((a, b) => {
                if (a.lvl !== b.lvl) return a.lvl - b.lvl;
                return a.count - b.count;
            });

            const tbody = document.getElementById('locBody');
            tbody.innerHTML = '';
            
            locations.forEach(loc => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td class="loc-lvl">${loc.lvl}</td>
                    <td class="loc-count">${loc.count}</td>
                    <td class="loc-name">${loc.name}</td>
                `;
                tbody.appendChild(tr);
            });
        }

		// ==========================================
        //      PART 3: EPIC BOSSES (Corrected Data)
        // ==========================================
        // Days: 0=Sun, 1=Mon, 2=Tue, 3=Wed, 4=Thu, 5=Fri, 6=Sat, -1=Daily
        const epics = [
            { name: "Ant Queen", day: -1, time: "20:00", icon: "ðŸœ", style: "aq" },
            { name: "Orfen", day: -1, time: "20:00", icon: "ðŸ•·ï¸", style: "orfen" },
            { name: "Core", day: -1, time: "20:00", icon: "ðŸ¤–", style: "core" },
            { name: "Baium", day: -1, time: "20:00", icon: "ðŸ¤´", style: "baium" },
            { name: "Helios", day: 1, time: "21:00", icon: "â˜€ï¸", style: "helios" },
            { name: "Kelbim", day: 2, time: "21:00", icon: "âš”ï¸", style: "kelbim" },
            { name: "Fafurion", day: 3, time: "21:00", icon: "ðŸ’§", style: "faf" },
            { name: "Lindivior", day: 4, time: "21:00", icon: "ðŸŒªï¸", style: "lind" },
            { name: "Valakas", day: 5, time: "21:00", icon: "ðŸ”¥", style: "val" },
            { name: "Antharas", day: 5, time: "21:00", icon: "ðŸ‰", style: "ant" }
        ];

        let epicMode = 'today'; // 'today' or 'upcoming'

        function setEpicMode(mode) {
            epicMode = mode;
            // Update buttons
            document.getElementById('btnToday').className = mode === 'today' ? 'btn-main active' : 'btn-main';
            document.getElementById('btnUpcoming').className = mode === 'upcoming' ? 'btn-main active' : 'btn-main';
            updateEpics();
        }

function updateEpics() {
            const select = document.getElementById('timezoneSelect');
            const targetOffset = parseFloat(select.value || -(new Date().getTimezoneOffset() / 60));
            const tbody = document.getElementById('epicBody');
            tbody.innerHTML = '';

            // 1. Get Exact Current Time
            const now = new Date();
            
            // 2. Calculate "Target Now" (for checking "Today")
            // This creates a date object shifted to the selected timezone
            const targetNowTimestamp = now.getTime() + (now.getTimezoneOffset() * 60000) + (targetOffset * 3600000);
            const targetNowDate = new Date(targetNowTimestamp);

            let fullList = epics.map(epic => {
                const [h, m] = epic.time.split(':').map(Number);
                
                // --- STEP A: Find the boss time in Real UTC ---
                // Server is UTC+3. So Boss UTC Hour = Server Hour - 3.
                // We construct a Date object for "Today's Spawn" in UTC.
                let spawnDate = new Date();
                spawnDate.setUTCHours(h - 3, m, 0, 0);

                // --- STEP B: Handle Weekly Days ---
                if (epic.day !== -1) {
                    // It's a weekly boss. Find the correct date relative to the Server.
                    // 1. Get Server Time (Current UTC + 3 hours)
                    const serverNow = new Date(Date.now() + 3600000 * 3);
                    const serverDay = serverNow.getUTCDay(); // 0=Sun...6=Sat
                    
                    // 2. Calculate difference
                    let dayDiff = epic.day - serverDay;
                    
                    // 3. If the day passed (or is today but time passed), move to next week
                    // Check if specific time passed is handled below, so just align days first
                    if (dayDiff < 0) dayDiff += 7;
                    
                    // Adjust our spawnDate to match that day
                    spawnDate.setUTCDate(spawnDate.getUTCDate() + dayDiff);
                }

                // --- STEP C: Check if it has PASSED ---
                // If the calculated spawn is in the past relative to Real Now, move it forward
                if (spawnDate < now) {
                    if (epic.day === -1) {
                        spawnDate.setUTCDate(spawnDate.getUTCDate() + 1); // Daily -> Tomorrow
                    } else {
                        spawnDate.setUTCDate(spawnDate.getUTCDate() + 7); // Weekly -> Next Week
                    }
                }

                // --- STEP D: Create Display Date ---
                // Shift the UTC time by the User's Offset to show "Local" time
                // We use a trick: create a new date shifted by the offset, then read it as UTC
                const displayTimestamp = spawnDate.getTime() + (targetOffset * 3600000);
                const displayDate = new Date(displayTimestamp);

                return { 
                    ...epic, 
                    realSpawnDate: spawnDate, // Real absolute time (for sorting)
                    displayDate: displayDate  // Shifted time (for text)
                };
            });

            // 3. Filter & Sort
            let displayList = [];
            
            if (epicMode === 'today') {
                // Filter: Only show if the Display Date is actually "Today" in user's selected timezone
                displayList = fullList.filter(item => {
                    return item.displayDate.getUTCDate() === targetNowDate.getUTCDate() && 
                           item.displayDate.getUTCMonth() === targetNowDate.getUTCMonth();
                });
                // Sort Today chronologically
                displayList.sort((a, b) => a.realSpawnDate - b.realSpawnDate);
            } else {
                // Upcoming: Show everything
                displayList = fullList;
                // Sort by Day of Week (Mon -> Sun)
                displayList.sort((a, b) => {
                    let dayA = a.displayDate.getUTCDay() || 7; 
                    let dayB = b.displayDate.getUTCDay() || 7;
                    if (dayA !== dayB) return dayA - dayB;
                    return a.realSpawnDate - b.realSpawnDate;
                });
            }

            // 4. Render
            if (displayList.length === 0 && epicMode === 'today') {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="3" class="empty-state">
                            <span class="empty-icon">ðŸ˜´</span>
                            No Epic Bosses remaining for today.<br>Check "Upcoming" tab.
                        </td>
                    </tr>
                `;
                return;
            }

            const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            
            displayList.forEach(item => {
                const date = item.displayDate;
                // Note: We use getUTC methods because we manually shifted the timestamp 
                // to represent the selected timezone
                const dayName = days[date.getUTCDay()];
                const hh = String(date.getUTCHours()).padStart(2, '0');
                const mm = String(date.getUTCMinutes()).padStart(2, '0');
                const timeStr = `${hh}:${mm}`;
                
                const isToday = date.getUTCDate() === targetNowDate.getUTCDate() && 
                                date.getUTCMonth() === targetNowDate.getUTCMonth();
                
                const dayBadge = isToday ? `<span class="day-badge">Today</span>` : dayName;
                const rowClass = isToday ? 'today' : '';

                const tr = document.createElement('tr');
                tr.className = rowClass;
                tr.innerHTML = `
                    <td class="time-col" style="font-size:0.9em; width:20%">${dayBadge}</td>
                    <td class="time-col" style="color:#d8b4fe">${timeStr}</td>
                    <td class="event-col">
                        <span class="icon ${item.style}">${item.icon}</span> 
                        ${item.name}
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // --- START ALL ---
        initSchedule();
        initDestruction();
        setTimeout(updateEpics, 500);

    </script>
</body>
</html>
